---
title: Refactoring React - Part 2
path: /refactoring-react-part-2
date: 2020-01-19
draft: true
---
so next step is converting to typescript! 
luckily create-react-app have made to super simple to add typescript support to an exisiting project, just by running 
```
yarn add typescript @types/node @types/react @types/react-dom @types/jest
```

i am using the cheatsheet from 
https://github.com/typescript-cheatsheets/react-typescript-cheatsheet#reacttypescript-cheatsheets 

One of the beatuies about typescript is that it is just like javasript, which means you do not break your entire app by adding the support for it, you can just convert gradually to it. 

However after we cleaned the home component up so thourghully, there is notthing to typecheck, so just altering the delcartion of Home to `const Home: React.FC` is all we need here, but lets go though the componetns that Home renders. 



CTAImage -- looks like this 
```
import React from "react";
import PropTypes from "prop-types";
import Button from "../common/Button";
import { Link } from "react-router-dom";

const CTAImage = ({ heading, paragraph, image }) => {
  return (
    <div className="relative flex items-center ">
      <div className="relative w-full h-full overflow-hidden py-56 md:rounded-lg">
        <div className="w-10/12 md:w-1/2 mx-auto z-10 relative">
          <h1 className="text-5xl font-serif text-center leading-none text-white font-bold">
            {heading}
          </h1>
          <p className="text-center mt-4 text-lg text-white">{paragraph}</p>
          <Link to="/products">
            <Button title="Shop now" center={true} />
          </Link>
        </div>
        <img
          className="absolute inset-0 w-full h-full object-cover object-center z-0"
          src={image}
          alt=""
        />
        <div className="absolute inset-0 w-full h-full bg-gray-900 opacity-50"></div>
      </div>
    </div>
  );
};

CTAImage.propTypes = {
  heading: PropTypes.string.isRequired,
  paragraph: PropTypes.string.isRequired,
  image: PropTypes.string.isRequired
};

export default CTAImage;

```

Lets make it typescript :) 
but hey... we dont have any test for this? lets fix that

This is a pretty simple component so the only thing I test is that the props given is rendered correctly and that if there is not given the required props, it fails. 

Looks like this 
```
test("should render props correctly", () => {
  const { getByTestId } = render(
    <CTAImage
      heading="Test heading"
      paragraph="Test paragraph"
      image="http://test.dk"
    />,
    { wrapper: MemoryRouter }
  );

  expect(getByTestId("heading").textContent).toBe("Test heading");
  expect(getByTestId("paragraph").textContent).toBe("Test paragraph");
  expect(getByTestId("image").getAttribute("src")).toBe("http://test.dk");
});

test("should throw error when not given props", () => {
  render(<CTAImage />, { wrapper: MemoryRouter });

  expect(console.error).toBeCalledTimes(3);
});

```

Type script is also pretty simple, we use the `React.FC` to create the functional component and it looks like this
```
const CTAImage: React.FC<{
  heading: string;
  paragraph: string;
  image: string;
}> = ({ heading, paragraph, image }) => {
  return (
    <div className="relative flex items-center ">
      <div className="relative w-full h-full overflow-hidden py-56 md:rounded-lg">
        <div className="w-10/12 md:w-1/2 mx-auto z-10 relative">
          <h1
            data-testid="heading"
            className="text-5xl font-serif text-center leading-none text-white font-bold"
          >
            {heading}
          </h1>
          <p
            data-testid="paragraph"
            className="text-center mt-4 text-lg text-white"
          >
            {paragraph}
          </p>
          <Link to="/products">
            <Button title="Shop now" center={true} />
          </Link>
        </div>
        <img
          data-testid="image"
          className="absolute inset-0 w-full h-full object-cover object-center z-0"
          src={image}
          alt=""
        />
        <div className="absolute inset-0 w-full h-full bg-gray-900 opacity-50"></div>
      </div>
    </div>
  );
};

CTAImage.propTypes = {
  heading: PropTypes.string.isRequired,
  paragraph: PropTypes.string.isRequired,
  image: PropTypes.string.isRequired
};

```

Lets move on to the Featured roasters component. Again, we do not have test for this single component, only for when it was used in the home component. However since this component does not receive any props, it does not "change", so the test in Home from the previous post, will be the very alike. However! if we were to change the Home component once to not use it, we would lose the test for it. So we add it anyway.

We dont want to rewrite the mock data, so for that reason I move it to a file in my utils folder called `mockData.js`. Here i export each of the arrays such that I can just import them in the tests. This also measn that I could fill it with for instance 10 elements, but if I only need 3, i cloud just take the first three of the array. 
So I will skip the test here, since it is very similar to the one in home, done in the last blog post, otherwise you can check it in the git repo. 

Good, now that it is tested, I want to convert `FeaturedRoasters` compoonent to typescript. 
We are using the ook useFetchFeauterdRoasters. This should also be converted to typescript, so lets head to that one .  It was however all changes to the hooks. The where given returntypes like for example this 
```
interface ApiResponse {
  data: Array<object>;
}

interface Error {
  message: string;
}

type returnType = {
  response: null | ApiResponse;
  error: null | Error;
  isLoading: boolean;
};
```
With this done our FeaturedRoasters components look super, however I an getting a warning that my FeaturedRoasters are possibly null and also that id does not exist on it. We should probably also interface this type :) 
For now we only add the id to the interface, so now the types look like this 

```
interface ApiResponse {
  data: Array<Roaster>;
}

interface Error {
  message: string;
}

interface Roaster {
  id: string;
}

type returnType = {
  response: null | ApiResponse;
  error: null | Error;
  isLoading: boolean;
};
```

now regarding that the data can be null, that is actually a case I didn't cover by the tests! No reuslts! :) Lets fix it 
FeaturedRoasters now look like this 
```
const FeaturedRoasters: React.FC = () => {
  const { featuredRoasters, error, isLoading } = useFetchFeaturedRoasters();

  if (error) {
    return <Error message={error.message} />;
  }

  if (isLoading) {
    return <Loading />;
  }

  return (
    <>
      <div className=" mt-10 mb-3">
        <h2 className="text-2xl md:text-3xl font-serif text-center font-bold">
          Featured Coffee Roasters
        </h2>
      </div>
      <div className="flex -mx-2">
        {featuredRoasters ? (
          featuredRoasters.map(roaster => (
            <Roaster key={roaster.id} info={roaster} />
          ))
        ) : (
          <Error message="No results" />
        )}
      </div>
    </>
  );
};
```